# External services needed for application #

The application runs remotely prepared tests. 

## Available tests database ##
API that responses with an array of JSON objects (available tests). Those objects will be used to populate the list of test available for downloading. Test metadata will be stored on local storage (database) when test is downloaded. 
  
Test ID could be generated by the same server that is used to upload set of pictures; so all pictures are packed together with metadata.

Currently both TestList.json and an example T1.zip files are available on a public URL and are downloaded to an internal storage on a mobile.

* Test metadata structure in JSON
```
#!json
[ {TestInfo}, ... ]

TestInfo
{
  "id":               String,   // uuid()
  "name":             String,   // test name
  "description":      String,   // test description
  "resources":        String,   // URL to <TestID>.zip file
  "resultsServer":    String,   // URL to POST results to
  "type":             String,   // test type eg "Ishihara"
  "version":          int,      // if used
  "firstPlate"        int       // null if not relevant  
}

```

## Plates resources ##
Expecting test to be uploaded by researcher to resource server packed in a <TestID>.zip file. It must correspond with TestInfo.resources field.
The zip file consists of:
  
 * a set of plate pictures - filenames corespond with Plate.filename in the data structure. 
 
 * plates.json - an additional JSON file with an array of Plate objects. If it is requested to show any of plates more then once, the solution would be to have multiply Plate objects in the array in the file - picture files are not duplicated. As in IshiharaPlate example, for basic red-green deficiency attributes "protanStrong" and "deutanStrong" should be the same. If "extra' attribute is set to "true" it means that plate is an additional one to differentiate between Protan and Deutan (currently not in use - Protan and Deutan counters are kept during the whole process).
 
 ```
#!json
[ {Plate}, ... ]

IshiharaPlate
{
  "id":           int,    //  plate id 
  "filename"      String  //  file path <TestID>/"filename"
  "normal":       int,    //  expected input value for normal vision
  "protanStrong": int,    //  expected input value for vision deficiency
  "deutanStrong": int,    //  expected input value for vision deficiency
  "total":        int,    //  expected input value for total color blindness
  "extra":        bool    //  if true this plate may be in the calculation of additional results  
}
```

 * thresholds.json - an additional JSON file with extra data concerning results interpretation. In an Ishihara test example number of plates with an answer indicating normal sight is considered; two values are used in the JSON file: normal - number of answers above this limit means "normal vision", deficiency - the number of answers below it means "red-green" colour deficiency. If number of given answers is between those two values - the result is uncertain. We use 5 seconds limit for an answer, but it could be overidden by a timeLimit attribute.
  ```
#!json
IshiharaThreshold
{
  "normal":       int,    //  expected input value for normal vision
  "deficiency":   int,    //  expected input value for vision deficiency
  "timeLimit":    int     //  optional, to define "show plate" time (other then default)
}
```









